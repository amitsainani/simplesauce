<!DOCTYPE html>
<meta charset="utf-8">
<title>Simplesauce Log</title>
<style>
body {
  font-family: "Helvetica Neue", Helvetica, sans-serif;
  max-width: 640px;
  margin: 0 auto;
  background: #f0f0f0;
  font-size: 14px;
}

a {
  color: inherit;
}

div.commit {
  padding-top: 20px;
}

div.commit:first-child {
  padding-top: 0;
}

div.commit-info {
  padding-bottom: 10px;
  color: gray;
  font-size: 18px;
  padding-bottom: 10px;
}

div.commit-info a {
  color: black;
  font-weight: bold;
  text-decoration: none;
}

div.commit-info a:hover {
  text-decoration: underline;
}

.job.browser-iexplore {
  background-image: url(img/64-ie.png);
}

.job.browser-firefox {
  background-image: url(img/64-firefox.png);
}

.job.browser-chrome {
  background-image: url(img/64-chrome.png);
}

.job.browser-opera {
  background-image: url(img/Opera_48x48.png);
}

.pass a:hover {
  background: rgba(0, 0, 0, 0.2);
}

.fail a:hover {
  background: rgba(255, 255, 255, 0.2);
}

.job {
  padding: 10px 10px 10px 64px;
  min-height: 36px;
  background-size: 48px 48px;
  background-position: 8px 50%;
  background-repeat: no-repeat;
}

.pass {
}

.fail {
  background-color: firebrick;
  color: white;
}

a.more {
  display: inline-block;
  vertical-align: bottom;
  text-decoration: none;
  font-size: 10px;
  padding: 2px 6px;
  background: #555555;
  color: white;
}

a.more:hover {
  background: black;
}

.failure-reason {
  background: rgba(0, 0, 0, 0.2);
  margin-top: 4px;
  padding: 4px;
  font-size: 12px;
}

.failure-reason:before {
  content: 'reason: ';
  font-weight: bold;
}
</style>
<h1>Simplesauce Log</h1>
<div id="entries"></div>
<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
<script>
var BROWSER_NAMES = {
  iexplore: "Internet Explorer",
  opera: "Opera",
  firefox: "Firefox",
  chrome: "Chrome"
};

function text(string) {
  return $(document.createTextNode(string));
}

function showLog(log) {
  var commit = null;
  log.entries.forEach(function(entry) {
    var caps = entry.capabilities;
    var data = caps['custom-data'];
    var shortname = data.repository.split("github.com/")[1];
    var shortcommit = data.commit.slice(0, 7);
    var shortid = shortname + "@" + shortcommit;

    if (!(commit && commit.attr("data-shortid") == shortid)) {
      commit = $('<div class="commit"></div>')
        .attr("data-shortid", shortid)
        .appendTo("#entries");
      var commitInfo = $('<div class="commit-info"></div>').appendTo(commit);
      $('<a class="shortname"></a>')
        .text(shortname)
        .attr("href", data.repository)
        .appendTo(commitInfo);
      text(" @ ").appendTo(commitInfo);
      $('<a class="shortcommit"></a>')
        .text(shortcommit)
        .attr("href", data.repository + "/commit/" + data.commit)
        .appendTo(commitInfo);
    }
    var div = $('<div class="job"></div>').appendTo(commit);
    if (caps.passed)
      div.addClass("pass");
    else
      div.addClass("fail");
    if (entry.result) {
      $('<span class="results">' + entry.result.passed + ' of ' +
        entry.result.total + ' <a class="tests">tests</a> pass in ' +
        entry.result.runtime + 'ms</span>').appendTo(div);
    } else {
      $('<span>All <a class="tests">tests</a> fail</span>')
        .appendTo(div);
    }
    text(" on ").appendTo(div);
    $('<span class="browser"></span>')
      .text(BROWSER_NAMES[caps.browserName] +
            (caps.version ? ' ' + caps.version : ''))
      .appendTo(div);
    div.addClass("browser-" + caps.browserName);
    text(". ").appendTo(div);
    if (entry.sessionURL) {
      $('<a class="more">more&hellip;</a>')
        .attr("href", entry.sessionURL)
        .appendTo(div);
    }
    if (!caps.passed && data.failureReason) {
      $('<div class="failure-reason"></div>')
        .text(data.failureReason)
        .appendTo(div);
    }
    div.find('a.tests').attr("href", data['tests-url']);
  });
}

$(window).ready(function() {
  if (window.location.search == "?sampledata=1")
    jQuery.getScript("js/sample-log.js", function() {
      showLog(SAMPLE_LOG);
    });
  else
    jQuery.get("log.json", showLog);
});
</script>
